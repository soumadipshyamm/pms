<div class="app-main__outer">
  <div class="app-main__inner">
    <!-- dashboard main header -->
    <div class="app-page-title">
      <div class="page-title-wrapper">
        <div class="page-title-heading">
          <div>
            <h2><span><%= translation.consultantManagement.title.heading %> </span></h2>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="main-card mb-3 card">
          <div class="card-header staff_header">
            <div class="header_title">
              <h2>  <%= translation.consultantManagement.title.add %> </h2>
            </div>
          </div>
          <div class="card-body">
            <div class="add_newstaff">
              <form class="adminFrm" data-action="vendor-create" method="post">
                <input type="hidden" name="_csrf" value="<%=_csrfToken%>">
                <input type="hidden" name="updateId" value="<%=(oldData)?oldData.id:""%>">
                <div class="row">
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label"
                        ><%= translation.consultantManagement.add_edit_box.typeLabel %> <span class="text-danger">*</span>
                      </label>
                      <select name="profile_id" id="profile_id" class="form-control requiredCheck" data-check="Type">
                            <option value="4" <%=(oldData && oldData.profile_id=='4')?"selected":""%>>Contractor</option>
                            <option value="5" <%=(oldData && oldData.profile_id=='5')?"selected":""%>>Consultant</option>
                            <option value="9" <%=(oldData && oldData.profile_id=='9')?"selected":""%>>Supplier</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label"
                        >Sub Type <span class="text-danger">*</span>
                      </label>
                      <select name="sub_type" id="sub_type" class="form-control requiredCheck" data-check="Type">
                            
                      </select>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="single-login">
                      <label class="login-label"> <%= translation.consultantManagement.add_edit_box.organizationLabel %>  <span class="text-danger">*</span> </label>
                      <input
                        class="form-control requiredCheck "
                        type="text"
                        name="organization"
                        id="organization"
                        placeholder="<%= translation.consultantManagement.add_edit_box.organizationPlaceholder %> "
                        data-check="<%= translation.consultantManagement.add_edit_box.organizationCheck %> "
                        value="<%=(oldData)?oldData?.vendorInfo?.organization:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="single-login">
                      <label class="login-label"> Organization Email  <span class="text-danger">*</span> </label>
                      <input
                        class="form-control requiredCheck "
                        type="text"
                        name="organization_email"
                        id="organization_email"
                        placeholder="Enter Organization Email"
                        data-check="Organization email"
                        value="<%=(oldData)?oldData?.vendorInfo?.organization_email:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="single-login">
                      <label class="login-label"> Organization Phone  <span class="text-danger">*</span> </label>
                      <input
                        class="form-control requiredCheck "
                        type="text"
                        name="organization_phone"
                        id="organization_phone"
                        placeholder="Enter Organization Phone"
                        data-check="Organization phone"
                        value="<%=(oldData)?oldData?.vendorInfo?.organization_phone:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label"> Organization Address  <span class="text-danger">*</span> </label>
                      <input
                        class="form-control requiredCheck "
                        type="text"
                        name="organization_address"
                        id="organization_address"
                        placeholder="Enter Organization address"
                        data-check="Organization address"
                        value="<%=(oldData)?oldData?.vendorInfo?.organization_address:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="single-login">
                      <label class="login-label"> Commercial registration no.  <span class="text-danger">*</span> </label>
                      <input
                        class="form-control requiredCheck "
                        type="text"
                        name="commercial_register_no"
                        id="commercial_register_no"
                        placeholder="Enter Commercial registration no."
                        data-check="Commercial registration no."
                        value="<%=(oldData)?oldData?.vendorInfo?.commercial_register_no:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="single-login">
                      <label class="login-label"> IBAN  <span class="text-danger">*</span> </label>
                      <input
                        class="form-control requiredCheck "
                        type="text"
                        name="iban_no"
                        id="iban_no"
                        placeholder="Enter IBAN"
                        data-check="IBAN"
                        value="<%=(oldData)?oldData?.vendorInfo?.iban_no:""%>"
                      />
                    </div>
                  </div>
                   <div class="col-md-4">
                    <div class="single-login">
                      <label class="login-label"> Upload General Organization of Social Insurance (GOSI)  <span class="text-danger">*</span> </label>
                      <input
                        class=" <%=!oldData?.vendorInfo?.gosi_certificate?"requiredCheck":""%>"
                        type="file"
                        name="gosi_certificate"
                        id="gosi_certificate"
                        placeholder="Enter GOSI Certificate"
                        data-check="GOSI Certificate"
                        
                      />
                    </div>
                    <% if(oldData?.vendorInfo?.gosi_certificate) { %>
                    <div class="row mt-3 mb-3">
                      <a target="_blank" href="/uploads/vendor/<%=oldData?.vendorInfo?.gosi_certificate%>">View Document</a>
                    </div>
                    <% } %>
                  </div>
                   <div class="col-md-4">
                    <div class="single-login">
                      <label class="login-label"> Upload VAT Registration Certificate  <span class="text-danger">*</span> </label>
                      <input
                        class="<%=!oldData?.vendorInfo?.vat_registration_certificate?"requiredCheck":""%> "
                        type="file"
                        name="vat_registration_certificate"
                        id="vat_registration_certificate"
                        placeholder="Enter VAT Registration Certificate"
                        data-check="VAT Registration Certificate"
                        
                      />
                    </div>
                    
                    <% if(oldData?.vendorInfo?.vat_registration_certificate) { %>
                    <div class="row mt-3 mb-3">
                      <a target="_blank" href="/uploads/vendor/<%=oldData?.vendorInfo?.vat_registration_certificate%>">View Document</a>
                    </div>
                    <% } %>
                  </div>
                   <div class="col-md-4">
                    <div class="single-login">
                      <label class="login-label">Upload Saudization Certificate  <span class="text-danger">*</span> </label>
                      <input
                        class="<%=!oldData?.vendorInfo?.saudization_certificate?"requiredCheck":""%> "
                        type="file"
                        name="saudization_certificate"
                        id="saudization_certificate"
                        placeholder="Enter Saudization Certificate"
                        data-check="Saudization Certificate"
                        
                      />
                    </div>
                    <% if(oldData?.vendorInfo?.saudization_certificate) { %>
                    <div class="row mt-3 mb-3">
                      <a target="_blank" href="/uploads/vendor/<%=oldData?.vendorInfo?.saudization_certificate%>">View Document</a>
                    </div>
                    <% } %>
                  </div>
                  <p class="mt-3 mb-2">Contact person Information</p>
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label">
                        <%= translation.consultantManagement.add_edit_box.firstNameLabel %> <span class="text-danger">*</span></label
                      >
                      <input
                        class="form-control requiredCheck allowOnlyLetter"
                        type="text"
                        name="first_name"
                        id="first_name"
                        placeholder=" <%= translation.consultantManagement.add_edit_box.firstNamePlaceholder %>"
                        data-check="<%= translation.consultantManagement.add_edit_box.firstNameCheck %>"
                        value="<%=(oldData)?oldData.first_name:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label">
                        <%= translation.consultantManagement.add_edit_box.lastNameLabel %>  <span class="text-danger">*</span>
                      </label>
                      <input
                        class="form-control requiredCheck allowOnlyLetter"
                        type="text"
                        name="last_name"
                        id="last_name"
                        placeholder="<%= translation.consultantManagement.add_edit_box.lastNamePlaceholder %> "
                        data-check="<%= translation.consultantManagement.add_edit_box.lastNameCheck %>"
                        value="<%=(oldData)?oldData.last_name:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label">
                        <%= translation.consultantManagement.add_edit_box.emailLabel %> <span class="text-danger">*</span></label
                      >
                      <input
                        class="form-control requiredCheck"
                        type="email"
                        name="email"
                        id="email"
                        placeholder="<%= translation.consultantManagement.add_edit_box.emailPlaceholder %>"
                        data-check="<%= translation.consultantManagement.add_edit_box.emailCheck %>"
                        value="<%=(oldData)?oldData.email:""%>"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="single-login">
                      <label class="login-label">
                        <%= translation.consultantManagement.add_edit_box.phoneLabel %> <span class="text-danger">*</span>
                      </label>
                      <input
                        class="form-control requiredCheck"
                        type="text"
                        name="phone"
                        id="phone"
                        placeholder="<%= translation.consultantManagement.add_edit_box.phonePlaceholder %> "
                        data-check="<%= translation.consultantManagement.add_edit_box.phoneCheck %>"
                        value="<%=(oldData)?oldData.phone:""%>"
                        onkeypress="return isNumber()"
                      />
                    </div>
                  </div>
                  
                  
                  <div class="col-12 mt-4 text-right">
                    <button
                      type="submit"
                      class="btn-shadow btn btn-info btn_dashboard"
                    >
                      <%=(oldData)?"UPDATE":"SAVE"%> USER
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
 <script>
  $(document).ready(function() {
    var oldCountry = "<%=(oldData)?oldData.country_id:''%>";
    var oldState = "<%=(oldData)?oldData.state_id:''%>";
    var oldCity = "<%=(oldData)?oldData.city_id:''%>";
    if(oldCountry!=""){
        getStates(oldCountry,oldState);
    }
    if(oldState!=""){
        getCities(oldState,oldCity);
    }
  })
  $(document).on('change','#country',function() {
      getStates($(this).find('option:selected').val());
  })
  $(document).on('change','#state',function() {
      getCities($(this).find('option:selected').val());
  })
  const getStates = (countryId,oldState)=>{
    $.ajax({
      type:"POST",
      url:"/get-states-by-country",
      data:{_csrf:_token,countryId:countryId},
      dataType:"JSON",
      beforeSend:function(){
        $("#state").html(`<option value="">Processing...</option>`);
      },
      success:function(resp){
        let html =``;
        if(resp.status){
            resp.data.forEach(element => {
              html+=`<option value="${element.id}" ${(element.id==oldState)?"selected":""}>${element.name}</option>`;
            });
        }else{
            html+=`<option value="">No Data Found!</option>`
        }
        $("#state").html(html);
      }
    })
  };
  const getCities = (stateId,oldCity)=>{
    $.ajax({
      type:"POST",
      url:"/get-city-by-state",
      data:{_csrf:_token,stateId:stateId},
      dataType:"JSON",
      beforeSend:function(){
        $("#city").html(`<option value="">Processing...</option>`);
      },
      success:function(resp){
       let html =``;
        if(resp.status){
            resp.data.forEach(element => {
              html+=`<option value="${element.id}" ${(element.id==oldCity)?"selected":""}>${element.name}</option>`;
            });
        }else{
            html+=`<option value="">No Data Found!</option>`
        }
        $("#city").html(html);
      }
    })
  }
  $(document).ready(function() {
    $("#profile_id").trigger("change");
  })
  const subTypeSelectedItem = '<%=(oldData)?oldData?.vendorInfo?.sub_type:""%>';
  const contructorSubType = ["Main Contractor","Sub-contractor"];
  const consultantSubType = ["Survey Consultant","Soil Investigation Consultant","Value Engineering Consultant","Environmental Studies Consultant","Hydrology Studies Consultant"];
  const suplierSubType = ["Computers & Their Accessories","Stationeries"];
  $(document).on("change","#profile_id",function() {
    if($(this).find(":selected").val()==="4"){
        $("#sub_type").html('');
        contructorSubType.forEach(element=>{
          $("#sub_type").append(`<option value="${element}" ${subTypeSelectedItem===element?"selected":""}>${element}</option>`)
        })
    }
    if($(this).find(":selected").val()==="5"){
      $("#sub_type").html('');
        consultantSubType.forEach(element=>{
          $("#sub_type").append(`<option value="${element}" ${subTypeSelectedItem===element?"selected":""}>${element}</option>`)
        })
    }
    if($(this).find(":selected").val()==="9"){
      $("#sub_type").html('');
        suplierSubType.forEach(element=>{
          $("#sub_type").append(`<option value="${element}" ${subTypeSelectedItem===element?"selected":""}>${element}</option>`)
        })
    }
  })
 </script>